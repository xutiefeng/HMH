C51 COMPILER V9.60.0.0   MAIN                                                              12/14/2022 15:21:14 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE c\main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\main.lst) O
                    -BJECT(main.obj)

line level    source

   1           //************************************************************
   2          //  Copyright (c) 深圳市赛元微电子有限公司
   3          //      文件名称        : main.c
   4          //      作者            : 
   5          //      模块功能        : 
   6          //  最后更正日期:
   7          //      版本            : 
   8          //              :  
   9          //*************************************************************
  10          #include "h\SC95F861xB_C.h"
  11          #include "h\data_type.h"
  12          #include "lib\SensorMethod.h"
  13          
  14          //*****************全局变量区***************************************************
  15          INT32U exKeyValueFlag = 0;              //当前轮按键标志
  16          INT8U  Timercount = 0;                  //定时器计数
  17          BOOL   TimerFlag_1ms = 0;               //定时器1MS标志
  18          //INT8U TEST[80]=0;
  19          //INT8U idata TEST2[120]=0;
  20          unsigned int jj;
  21           /**************************************************
  22          *函数名称：void TimerInit(void) 
  23          *函数功能：定时器初始化
  24          *入口参数：void
  25          *出口参数：void
  26          **************************************************/
  27          void TimerInit(void)
  28          {
  29   1              TMCON = (TMCON&0xfe)|(0<<0);            //bit0: 0为FOSC/12,1为FOSO
  30   1      
  31   1              TMOD = TMOD&0xf0;                                       //设置定时0，工作方式0
  32   1              TMOD = TMOD|0x00;
  33   1              TH0=(8192-1000)/32;                             //1000*1=1000us ,1MS
  34   1              TL0=(8192-1000)%32;
  35   1              TF0 = 0;                                                    //清中断标志
  36   1              TR0=0;                                                          //关定时器0
  37   1              ET0=1;                                                          //使能定时器0中断
  38   1              TR0=1;
  39   1      }
  40          
  41          /**************************************************
  42          *函数名称：void timer0()interrupt 1 
  43          *函数功能：定时器中断服务函数
  44          *入口参数：void
  45          *出口参数：void 
  46          **************************************************/
  47          void timer0()interrupt 1
  48          {
  49   1              TH0 = (8192-1000)/32;                           //2000*1/4us=500us
  50   1              TL0 = (8192-1000)%32;   
  51   1              TimerFlag_1ms = 1;      
  52   1      }
  53           /**************************************************
  54          *函数名称：void  Sys_Init(void) 
C51 COMPILER V9.60.0.0   MAIN                                                              12/14/2022 15:21:14 PAGE 2   

  55          *函数功能：系统初始化
  56          *入口参数：void
  57          *出口参数：void  
  58          **************************************************/
  59          void  Sys_Init(void)
  60          {       
  61   1              WDTCON  = 0x10;                             //1--1 -- 00    开WDT,WDT清0,WDT 524.288ms溢出;烧录时，可Code Option选择ENWDT
  62   1      
  63   1              //TK对应的IO设置为强推挽输出
  64   1              P0CON = 0xFF;
  65   1              P0PH  = 0xFF;   
  66   1              P1CON = 0xFF;
  67   1              P1PH  = 0xFF;
  68   1              P2CON = 0xFF;
  69   1              P2PH  = 0xFF;
  70   1              P5CON = 0xFF;
  71   1              P5PH  = 0xFF;
  72   1              P0 = 0xFF;
  73   1              P1 = 0xFF;
  74   1              P2 = 0xFF;
  75   1              P5 = 0x00;      
  76   1                         
  77   1              EA = 1;                                         //开总中断      
  78   1          TimerInit();                                //定时器初始化
  79   1      }
  80          
  81          /**************************************************
  82          *函数名称：void  Sys_Scan(void) 
  83          *函数功能：扫描TK和显示
  84          *入口参数：void
  85          *出口参数：void  
  86          **************************************************/
  87          void Sys_Scan(void)
  88          {                               
  89   1              if(SOCAPI_TouchKeyStatus&0x80)      //重要步骤2:  触摸键扫描一轮标志，是否调用TouchKeyScan()一定要根据此标
             -志位置起后
  90   1               {                                                                                                                                              
  91   2                      SOCAPI_TouchKeyStatus &= 0x7f;  //重要步骤3: 清除标志位， 需要外部清除。                                                                                                            
  92   2                      exKeyValueFlag = TouchKeyScan();//按键数据处理函数 
  93   2                      
  94   2                      TouchKeyRestart();                              //启动下一轮转换                                                                                                                                                                                                                                                                        
  95   2              }                          
  96   1      }
  97          /**************************************************
  98          *函数名称：void main(void)                                                                
  99          *函数功能：主函数
 100          *入口参数：void
 101          *出口参数：void  
 102          **************************************************/
 103          void main(void)
 104          {                                       
 105   1              Sys_Init();
 106   1              
 107   1              //触控按键初始化
 108   1              TouchKeyInit();
 109   1      
 110   1              while(1)
 111   1              {
 112   2                 WDTCON  = 0x10;                         
 113   2                 if(TimerFlag_1ms==1)
 114   2                 {
 115   3                              TimerFlag_1ms=0;        
C51 COMPILER V9.60.0.0   MAIN                                                              12/14/2022 15:21:14 PAGE 3   

 116   3                              Timercount++;
 117   3                              if(Timercount>10)
 118   3                              {
 119   4                                      Timercount=0;
 120   4                                      Sys_Scan();
 121   4                              }                                                                                         
 122   3                 }
 123   2                                 
 124   2              } 
 125   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    137    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
