C51 COMPILER V9.59.0.0   KEY                                                               03/25/2024 20:30:55 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN ..\Output\key.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Apps\key.c LARGE OMF2 OPTIMIZE(0,SIZE) BROWSE INTVECTOR(0X2800) INCDI
                    -R(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) DEFINE(S
                    -C95F8x1xB) DEBUG PRINT(..\List\key.lst) TABS(2) OBJECT(..\Output\key.obj)

line level    source

   1          #include <SC95F8x1xB_C.H>
   2          #include  "key.h"
   3          
   4          #include "includeall.h"
   5          
   6          
   7          
   8          extern unsigned char  xdata   SOCAPI_TouchKeyStatus;          //API接口状态：bit7-一轮扫描完成标志  1:完成  0：未
             -完成
   9          
  10          static u8 sKeyValue = 0;
  11          static u8 sKeySelectCnt=0;
  12          static u8 sKeyReskCnt=0;
  13          
  14          
  15          /*********************************************************************************************************
             -********************************* 
  16          * 函数名称: KeyRest
  17          * 功能说明: 长按复位键3秒，蜂鸣器短鸣一声：0.2秒
  18                      长按复位键5秒，蜂鸣器长鸣一声：2秒
  19          * 输    入: 无  
  20          * 输    出: 无
  21          * 注意事项:
  22          **********************************************************************************************************
             -********************************/
  23          void KeyRest(void)
  24          { 
  25   1          static u8 sUseFactoryCnt =0;
  26   1      
  27   1          static u8 sKeyPressCnt =0;
  28   1          
  29   1          sUseFactoryCnt++;
  30   1          if(NoKeyPressFalg)
  31   1          {
  32   2            if(sKeyReskCnt >0 && sKeyReskCnt < 10 )
  33   2            {
  34   3              if(sUseFactoryCnt < _10S_Per50MS) //    
  35   3              {
  36   4                
  37   4                sKeyPressCnt++;
  38   4                if(sKeyPressCnt >5 )
  39   4                {
  40   5                  FactoryModeFlag = 1;
  41   5                  Buzzer3Flag = 1;
  42   5                  sKeyReskCnt = 0;
  43   5                  KeyRestFlag = 0;
  44   5                }         
  45   4                  
  46   4              }
  47   3        
  48   3              
  49   3            }
  50   2            else
C51 COMPILER V9.59.0.0   KEY                                                               03/25/2024 20:30:55 PAGE 2   

  51   2            {
  52   3                sKeyReskCnt = 0;
  53   3                KeyRestFlag = 0;
  54   3            }
  55   2          }
  56   1          
  57   1          
  58   1          if(KeyRestFlag)
  59   1          {
  60   2            sKeyReskCnt++;
  61   2          }
  62   1            
  63   1            
  64   1          else if(sKeyReskCnt > _10S_Per50MS || !KeyRestFlag)
  65   1          {
  66   2              return;
  67   2          }
  68   1              
  69   1          
  70   1          if(sKeyReskCnt == _3S_Per50MS)
  71   1          {
  72   2                Buzzer2Flag = 1;
  73   2                #if 0
                        LED1_R = 0;
                        LED2_R = 0;
                        LED3_R = 0;
                        LED4_R = 0;
                        LED1_L = 1;
                        LED2_L = 1;
                        LED3_L = 1;
                        LED4_L = 1;
                        #endif
  83   2          }
  84   1          else if(sKeyReskCnt == _5S_Per50MS)
  85   1          {
  86   2                Buzzer3Flag = 0;
  87   2                #if 1
  88   2                LED1_R = 1;
  89   2                LED2_R = 1;
  90   2                LED3_R = 1;
  91   2                LED4_R = 1;
  92   2                LED1_L = 0;
  93   2                LED2_L = 0;
  94   2                LED3_L = 0;
  95   2                LED4_L = 0;
  96   2                #endif
  97   2          }
  98   1            
  99   1      }
 100          
 101          void KeyGaoYaSwitch(void)
 102          {
 103   1          if(InputKey_io == 0 && !KeySwitchFlag1)
 104   1          {
 105   2              KeySwitchFlag1 = 1;
 106   2          }
 107   1          else if(InputKey_io == 0 && KeySwitchFlag1)
 108   1          {
 109   2          
 110   2            DLy_8616B();
 111   2              
 112   2            if(InputKey_io == 0)
C51 COMPILER V9.59.0.0   KEY                                                               03/25/2024 20:30:55 PAGE 3   

 113   2            {
 114   3              KeySwitchFlag  = 1;
 115   3            }
 116   2              
 117   2            else
 118   2            {
 119   3              KeySwitchFlag1 = 0;
 120   3            }
 121   2               
 122   2          }
 123   1          else
 124   1          {
 125   2              KeySwitchFlag = 0;
 126   2              KeySwitchFlag1= 0;
 127   2          }
 128   1          
 129   1      }
 130          
 131          
 132          
 133          /*********************************************************************************************************
             -********************************* 
 134          * 函数名称: KeySelect
 135          * 功能说明: 选择按键
 136          * 输    入: 无  
 137          * 输    出: 无
 138          * 注意事项: 短按有效
 139          **********************************************************************************************************
             -********************************/
 140          void KeySelect(void)
 141          {
 142   1          
 143   1          if(NoKeyPressFalg)
 144   1          {
 145   2            if(sKeySelectCnt >0 && sKeySelectCnt < 10 )
 146   2            {
 147   3            //短按
 148   3                if(RedLedtFlag && BlueLedFlag)
 149   3                {
 150   4                      BlueLedFlag = 0;
 151   4                      RedLedtFlag = 0;
 152   4                }
 153   3                
 154   3                else if(BlueLedFlag && !RedLedtFlag)  
 155   3                {
 156   4                  
 157   4                    BlueLedFlag = 0;
 158   4                    RedLedtFlag = 1;
 159   4                }
 160   3                
 161   3                else if(RedLedtFlag && !BlueLedFlag)
 162   3                {
 163   4                      BlueLedFlag = 1;
 164   4                      RedLedtFlag = 1;
 165   4                }
 166   3                
 167   3                
 168   3                else
 169   3                {
 170   4                    BlueLedFlag = 1;
 171   4                    RedLedtFlag = 0;
 172   4                }
C51 COMPILER V9.59.0.0   KEY                                                               03/25/2024 20:30:55 PAGE 4   

 173   3            }
 174   2            sKeySelectCnt = 0;
 175   2            KeySelecetFlag = 0;
 176   2          }
 177   1            
 178   1          if(KeySelecetFlag)
 179   1          {
 180   2            sKeySelectCnt++;
 181   2          }
 182   1            
 183   1          else if(sKeySelectCnt > _10S_Per50MS || !KeySelecetFlag)
 184   1          {
 185   2              return;
 186   2          }
 187   1          
 188   1        
 189   1          
 190   1          
 191   1        
 192   1          
 193   1          
 194   1          
 195   1      }
 196          /*********************************************************************************************************
             -********************************* 
 197          * 函数名称: KeyProcess
 198          * 功能说明: 处理按键长按短按功能
 199          * 输    入: 无  
 200          * 输    出: 无
 201          * 注意事项: 触发时间50ms
 202          **********************************************************************************************************
             -********************************/
 203          void NoKeyProcess(void)
 204          { 
 205   1        static u8 sNoKeytCnt=0; 
 206   1        if(NoKeyPressFalg)
 207   1        {
 208   2          sNoKeytCnt++;
 209   2        }
 210   1        
 211   1      }
 212          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    792    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
