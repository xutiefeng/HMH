C51 COMPILER V9.59.0.0   KEY                                                               04/02/2024 20:37:54 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN ..\Output\key.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Apps\key.c LARGE OMF2 OPTIMIZE(0,SIZE) BROWSE INTVECTOR(0X1000) INCDI
                    -R(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) DEFINE(S
                    -C95F8x1xB) DEBUG PRINT(..\List\key.lst) TABS(2) OBJECT(..\Output\key.obj)

line level    source

   1          #include <SC95F8x1xB_C.H>
   2          #include  "key.h"
   3          
   4          #include "includeall.h"
   5          
   6          
   7          
   8          extern unsigned char  xdata   SOCAPI_TouchKeyStatus;          //API接口状态：bit7-一轮扫描完成标志  1:完成  0：未
             -完成
   9          
  10          static u8 sKeyValue = 0;
  11          
  12          static u8 sKeyReskCnt=0;
  13          
  14          
  15          /*********************************************************************************************************
             -********************************* 
  16          * 函数名称: RestKeyProcess
  17          * 功能说明: 复位键按下，取消设置滤芯
  18          * 输    入: 无  
  19          * 输    出: 无
  20          * 注意事项:
  21          **********************************************************************************************************
             -********************************/
  22          void RestKeyProcess(void)
  23          {
  24   1          //LongPress_3sFlag = 0;
  25   1      }
  26          
  27          /*********************************************************************************************************
             -********************************* 
  28          * 函数名称: KeyRest
  29          * 功能说明: 长按复位键3秒，蜂鸣器短鸣一声：0.2秒
  30                      长按复位键5秒，蜂鸣器长鸣一声：2秒
  31          * 输    入: 无  
  32          * 输    出: 无
  33          * 注意事项:
  34          **********************************************************************************************************
             -********************************/
  35          void KeyRest(void)
  36          { 
  37   1          static u8 sUseFactoryCnt =0;
  38   1          static u8 sKeyReskCnt =0;//按下计时
  39   1          static u8 sKeyPressCnt =0;//按下次数
  40   1      
  41   1          if(sUseFactoryCnt < 0xff)
  42   1            sUseFactoryCnt++;
  43   1          
  44   1          if(NoKeyPressFalg)
  45   1          {
  46   2      ///////////////////////////////退出工程模式////////////////////////////////////////   
  47   2            if(sKeyReskCnt >0 && sKeyReskCnt < 20 )
  48   2            {
C51 COMPILER V9.59.0.0   KEY                                                               04/02/2024 20:37:54 PAGE 2   

  49   3      
  50   3            
  51   3              if(sUseFactoryCnt < _10S_Per50MS && !FactoryModeFlag) //上电10秒内    
  52   3              {
  53   4                
  54   4                sKeyPressCnt++;
  55   4                
  56   4                Buzzer3Flag = 1;
  57   4                
  58   4                if(sKeyPressCnt >4 )//复位键按五次进入工程模式
  59   4                {
  60   5                  FactoryModeFlag = 1;          
  61   5                  sKeyReskCnt = 0;
  62   5                  KeyRestFlag = 0;
  63   5                }   
  64   4              }
  65   3      
  66   3              sKeyReskCnt = 0;
  67   3              KeyRestFlag = 0;
  68   3              RestKeyProcess();//短按处理
  69   3            }
  70   2            else
  71   2            {
  72   3                sKeyReskCnt = 0;
  73   3            }
  74   2          } 
  75   1          
  76   1          if(KeyRestFlag)
  77   1          {
  78   2            KeyRestFlag = 0;
  79   2            
  80   2            sKeyReskCnt++;
  81   2          }
  82   1            
  83   1            
  84   1          else if(sKeyReskCnt > _10S_Per50MS || !KeyRestFlag)
  85   1          {
  86   2              return;
  87   2          }
  88   1              
  89   1          
  90   1          if(sKeyReskCnt == _3S_Per50MS)
  91   1          {
  92   2                Buzzer2Flag = 1;
  93   2                LongPress_5sFlag = 0;
  94   2                LongPress_3sFlag = 1;
  95   2          }
  96   1          else if(sKeyReskCnt == _5S_Per50MS)
  97   1          {
  98   2                Buzzer3Flag = 0;
  99   2                LongPress_5sFlag = 1;
 100   2                LongPress_3sFlag = 0;
 101   2          }
 102   1            
 103   1      }
 104          
 105          
 106          
 107          /*********************************************************************************************************
             -********************************* 
 108          * 函数名称: KeySelect
 109          * 功能说明: 选择按键
C51 COMPILER V9.59.0.0   KEY                                                               04/02/2024 20:37:54 PAGE 3   

 110          * 输    入: 无  
 111          * 输    出: 无
 112          * 注意事项: 短按有效
 113          **********************************************************************************************************
             -********************************/
 114          extern void setLED(u8 num,emColor color ,U_LED state,u8 time);
 115          
 116          
 117          
 118          
 119          void KeySelect(void)
 120          {
 121   1        
 122   1          static u8 sKeySelectCnt=0;
 123   1          
 124   1          if(KeySelecetFlag)//按下按键
 125   1          {
 126   2            KeySelecetFlag = 0;
 127   2            sKeySelectCnt++;
 128   2          }
 129   1      
 130   1          else if(NoKeyPressFalg)//松开按键
 131   1          {
 132   2            if(sKeySelectCnt >0 && sKeySelectCnt < 10 )
 133   2            {
 134   3      
 135   3              ///////////////////////////按键逻辑处理//////////////////////////////
 136   3                if(LongPress_5sFlag)
 137   3                { 
 138   4                    LongPress_5sFlag = 0;
 139   4                    RestFilter();
*** WARNING C206 IN LINE 139 OF ..\Apps\key.c: 'RestFilter': missing function-prototype
 140   4                }
 141   3                  
 142   3                else if(LongPress_3sFlag)
 143   3                {
 144   4                  if(gstFilte.type == ROFilter)
 145   4                  {
 146   5                    gstFilte.type = MixFilter;
 147   5                    setLED(5,BlueColor,blink,_2S_Per100MS);
 148   5                  }
 149   4                  else
 150   4                  {
 151   5                    gstFilte.type = ROFilter;
 152   5                    setLED(6,BlueColor,blink,_2S_Per100MS);
 153   5                  }
 154   4                  Buzzer2Flag = 1;
 155   4                  
 156   4                }     
 157   3            }
 158   2      
 159   2            
 160   2            
 161   2            sKeySelectCnt = 0;
 162   2            KeySelecetFlag = 0;
 163   2          }
 164   1      }
 165          
 166          
 167          /*********************************************************************************************************
             -********************************* 
 168          * 函数名称: KeyGaoYaSwitch
C51 COMPILER V9.59.0.0   KEY                                                               04/02/2024 20:37:54 PAGE 4   

 169          * 功能说明: 检测高压开关闭合还是断开
 170          * 输    入: 无  
 171          * 输    出: 无
 172          * 注意事项: 短按有效
 173          **********************************************************************************************************
             -********************************/
 174          
 175          void KeyGaoYaSwitch(void)
 176          {
 177   1          if(InputKey_io == 0 && !KeySwitchFlag1)
 178   1          {
 179   2              KeySwitchFlag1 = 1;
 180   2          }
 181   1          else if(InputKey_io == 0 && KeySwitchFlag1)
 182   1          {
 183   2          
 184   2            DLy_8616B();
 185   2              
 186   2            if(InputKey_io == 0)
 187   2            {
 188   3              KeySwitchFlag  = 1;
 189   3            }
 190   2              
 191   2            else
 192   2            {
 193   3              KeySwitchFlag1 = 0;
 194   3            }
 195   2               
 196   2          }
 197   1          else
 198   1          {
 199   2              KeySwitchFlag = 0;
 200   2              KeySwitchFlag1= 0;
 201   2          }
 202   1          
 203   1      }
 204          
 205          /*********************************************************************************************************
             -********************************* 
 206          * 函数名称: KeyProcess
 207          * 功能说明: 处理按键长按短按功能
 208          * 输    入: 无  
 209          * 输    出: 无
 210          * 注意事项: 触发时间50ms
 211          **********************************************************************************************************
             -********************************/
 212          void NoKeyProcess(void)
 213          { 
 214   1          static u8 sNoKeytCnt=0; 
 215   1        
 216   1          if(NoKeyPressFalg)
 217   1          {
 218   2            sNoKeytCnt++;
 219   2          }
 220   1          else
 221   1          {
 222   2            sNoKeytCnt = 0;
 223   2          }
 224   1        
 225   1          if(sNoKeytCnt > _10S_Per50MS)
 226   1          {
 227   2              LongPress_3sFlag = 0;
C51 COMPILER V9.59.0.0   KEY                                                               04/02/2024 20:37:54 PAGE 5   

 228   2              LongPress_5sFlag = 0;   
 229   2          } 
 230   1        
 231   1      }
 232          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    767    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      7    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
