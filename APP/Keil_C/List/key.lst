C51 COMPILER V9.59.0.0   KEY                                                               03/27/2024 21:25:07 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN ..\Output\key.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Apps\key.c LARGE OMF2 OPTIMIZE(0,SIZE) BROWSE INTVECTOR(0X1000) INCDI
                    -R(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) DEFINE(S
                    -C95F8x1xB) DEBUG PRINT(..\List\key.lst) TABS(2) OBJECT(..\Output\key.obj)

line level    source

   1          #include <SC95F8x1xB_C.H>
   2          #include  "key.h"
   3          
   4          #include "includeall.h"
   5          
   6          
   7          
   8          extern unsigned char  xdata   SOCAPI_TouchKeyStatus;          //API接口状态：bit7-一轮扫描完成标志  1:完成  0：未
             -完成
   9          
  10          static u8 sKeyValue = 0;
  11          static u8 sKeySelectCnt=0;
  12          static u8 sKeyReskCnt=0;
  13          
  14          
  15          /*********************************************************************************************************
             -********************************* 
  16          * 函数名称: KeyRest
  17          * 功能说明: 长按复位键3秒，蜂鸣器短鸣一声：0.2秒
  18                      长按复位键5秒，蜂鸣器长鸣一声：2秒
  19          * 输    入: 无  
  20          * 输    出: 无
  21          * 注意事项:
  22          **********************************************************************************************************
             -********************************/
  23          void KeyRest(void)
  24          { 
  25   1          static u8 sUseFactoryCnt =0;
  26   1          static u8 sKeyPressCnt =0;
  27   1          
  28   1          if(sUseFactoryCnt < 0xff)
  29   1            sUseFactoryCnt++;
  30   1          
  31   1          if(NoKeyPressFalg)
  32   1          {
  33   2            if(sKeyReskCnt >0 && sKeyReskCnt < 10 )
  34   2            {
  35   3              if(sUseFactoryCnt < _10S_Per50MS && !FactoryModeFlag) //    
  36   3              {
  37   4                
  38   4                sKeyPressCnt++;
  39   4                Buzzer3Flag = 1;
  40   4                if(sKeyPressCnt >4 )//复位键按五次进入工程模式
  41   4                {
  42   5                  FactoryModeFlag = 1;          
  43   5                  sKeyReskCnt = 0;
  44   5                  KeyRestFlag = 0;
  45   5                }         
  46   4                  
  47   4              }
  48   3       
  49   3              sKeyReskCnt = 0;
  50   3              KeyRestFlag = 0;        
C51 COMPILER V9.59.0.0   KEY                                                               03/27/2024 21:25:07 PAGE 2   

  51   3            }
  52   2            else
  53   2            {
  54   3                sKeyReskCnt = 0;
  55   3                KeyRestFlag = 0;
  56   3            }
  57   2          }
  58   1          
  59   1          
  60   1          if(KeyRestFlag)
  61   1          {
  62   2            sKeyReskCnt++;
  63   2          }
  64   1            
  65   1            
  66   1          else if(sKeyReskCnt > _10S_Per50MS || !KeyRestFlag)
  67   1          {
  68   2              return;
  69   2          }
  70   1              
  71   1          
  72   1          if(sKeyReskCnt == _3S_Per50MS)
  73   1          {
  74   2                Buzzer2Flag = 1;
  75   2                #if 0
                        LED1_R = 0;
                        LED2_R = 0;
                        LED3_R = 0;
                        LED4_R = 0;
                        LED1_L = 1;
                        LED2_L = 1;
                        LED3_L = 1;
                        LED4_L = 1;
                        #endif
  85   2          }
  86   1          else if(sKeyReskCnt == _5S_Per50MS)
  87   1          {
  88   2                Buzzer3Flag = 0;
  89   2                #if 1
  90   2                LED1_R = 1;
  91   2                LED2_R = 1;
  92   2                LED3_R = 1;
  93   2                LED4_R = 1;
  94   2                LED1_L = 0;
  95   2                LED2_L = 0;
  96   2                LED3_L = 0;
  97   2                LED4_L = 0;
  98   2                #endif
  99   2          }
 100   1            
 101   1      }
 102          
 103          void KeyGaoYaSwitch(void)
 104          {
 105   1          if(InputKey_io == 0 && !KeySwitchFlag1)
 106   1          {
 107   2              KeySwitchFlag1 = 1;
 108   2          }
 109   1          else if(InputKey_io == 0 && KeySwitchFlag1)
 110   1          {
 111   2          
 112   2            DLy_8616B();
C51 COMPILER V9.59.0.0   KEY                                                               03/27/2024 21:25:07 PAGE 3   

 113   2              
 114   2            if(InputKey_io == 0)
 115   2            {
 116   3              KeySwitchFlag  = 1;
 117   3            }
 118   2              
 119   2            else
 120   2            {
 121   3              KeySwitchFlag1 = 0;
 122   3            }
 123   2               
 124   2          }
 125   1          else
 126   1          {
 127   2              KeySwitchFlag = 0;
 128   2              KeySwitchFlag1= 0;
 129   2          }
 130   1          
 131   1      }
 132          
 133          
 134          
 135          /*********************************************************************************************************
             -********************************* 
 136          * 函数名称: KeySelect
 137          * 功能说明: 选择按键
 138          * 输    入: 无  
 139          * 输    出: 无
 140          * 注意事项: 短按有效
 141          **********************************************************************************************************
             -********************************/
 142          void KeySelect(void)
 143          {
 144   1          
 145   1          if(NoKeyPressFalg)
 146   1          {
 147   2            if(sKeySelectCnt >0 && sKeySelectCnt < 10 )
 148   2            {
 149   3            //短按
 150   3                if(RedLedtFlag && BlueLedFlag)
 151   3                {
 152   4                      BlueLedFlag = 0;
 153   4                      RedLedtFlag = 0;
 154   4                }
 155   3                
 156   3                else if(BlueLedFlag && !RedLedtFlag)  
 157   3                {
 158   4                  
 159   4                    BlueLedFlag = 0;
 160   4                    RedLedtFlag = 1;
 161   4                }
 162   3                
 163   3                else if(RedLedtFlag && !BlueLedFlag)
 164   3                {
 165   4                      BlueLedFlag = 1;
 166   4                      RedLedtFlag = 1;
 167   4                }
 168   3                
 169   3                
 170   3                else
 171   3                {
 172   4                    BlueLedFlag = 1;
C51 COMPILER V9.59.0.0   KEY                                                               03/27/2024 21:25:07 PAGE 4   

 173   4                    RedLedtFlag = 0;
 174   4                }
 175   3            }
 176   2            sKeySelectCnt = 0;
 177   2            KeySelecetFlag = 0;
 178   2          }
 179   1            
 180   1          if(KeySelecetFlag)
 181   1          {
 182   2            sKeySelectCnt++;
 183   2          }
 184   1            
 185   1          else if(sKeySelectCnt > _10S_Per50MS || !KeySelecetFlag)
 186   1          {
 187   2              return;
 188   2          }
 189   1          
 190   1        
 191   1          
 192   1          
 193   1        
 194   1          
 195   1          
 196   1          
 197   1      }
 198          /*********************************************************************************************************
             -********************************* 
 199          * 函数名称: KeyProcess
 200          * 功能说明: 处理按键长按短按功能
 201          * 输    入: 无  
 202          * 输    出: 无
 203          * 注意事项: 触发时间50ms
 204          **********************************************************************************************************
             -********************************/
 205          void NoKeyProcess(void)
 206          { 
 207   1        static u8 sNoKeytCnt=0; 
 208   1        if(NoKeyPressFalg)
 209   1        {
 210   2          sNoKeytCnt++;
 211   2        }
 212   1        
 213   1      }
 214          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    841    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
