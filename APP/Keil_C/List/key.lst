C51 COMPILER V9.59.0.0   KEY                                                               04/01/2024 21:04:53 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN ..\Output\key.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Apps\key.c LARGE OMF2 OPTIMIZE(0,SIZE) BROWSE INTVECTOR(0X1000) INCDI
                    -R(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) DEFINE(S
                    -C95F8x1xB) DEBUG PRINT(..\List\key.lst) TABS(2) OBJECT(..\Output\key.obj)

line level    source

   1          #include <SC95F8x1xB_C.H>
   2          #include  "key.h"
   3          
   4          #include "includeall.h"
   5          
   6          
   7          
   8          extern unsigned char  xdata   SOCAPI_TouchKeyStatus;          //API接口状态：bit7-一轮扫描完成标志  1:完成  0：未
             -完成
   9          
  10          static u8 sKeyValue = 0;
  11          static u8 sKeySelectCnt=0;
  12          static u8 sKeyReskCnt=0;
  13          
  14          
  15          /*********************************************************************************************************
             -********************************* 
  16          * 函数名称: KeyRest
  17          * 功能说明: 长按复位键3秒，蜂鸣器短鸣一声：0.2秒
  18                      长按复位键5秒，蜂鸣器长鸣一声：2秒
  19          * 输    入: 无  
  20          * 输    出: 无
  21          * 注意事项:
  22          **********************************************************************************************************
             -********************************/
  23          void KeyRest(void)
  24          { 
  25   1          static u8 sUseFactoryCnt =0;
  26   1          static u8 sKeyReskCnt =0;//按下计时
  27   1          static u8 sKeyPressCnt =0;//按下次数
  28   1      
  29   1          if(sUseFactoryCnt < 0xff)
  30   1            sUseFactoryCnt++;
  31   1          
  32   1          if(NoKeyPressFalg)
  33   1          {
  34   2      ///////////////////////////////退出工程模式////////////////////////////////////////   
  35   2            if(sKeyReskCnt >0 && sKeyReskCnt < 10 )
  36   2            {
  37   3      
  38   3            
  39   3              if(sUseFactoryCnt < _10S_Per50MS && !FactoryModeFlag) //上电10秒内    
  40   3              {
  41   4                
  42   4                sKeyPressCnt++;
  43   4                
  44   4                Buzzer3Flag = 1;
  45   4                
  46   4                if(sKeyPressCnt >4 )//复位键按五次进入工程模式
  47   4                {
  48   5                  FactoryModeFlag = 1;          
  49   5                  sKeyReskCnt = 0;
  50   5                  KeyRestFlag = 0;
C51 COMPILER V9.59.0.0   KEY                                                               04/01/2024 21:04:53 PAGE 2   

  51   5                }   
  52   4              }
  53   3      
  54   3              sKeyReskCnt = 0;
  55   3              KeyRestFlag = 0;  
  56   3              LongPress_5sFlag = 0;
  57   3              LongPress_3sFlag = 0;
  58   3      
  59   3            }
  60   2          } 
  61   1          
  62   1          if(KeyRestFlag)
  63   1          {
  64   2            sKeyReskCnt++;
  65   2          }
  66   1            
  67   1            
  68   1          else if(sKeyReskCnt > _10S_Per50MS || !KeyRestFlag)
  69   1          {
  70   2              return;
  71   2          }
  72   1              
  73   1          
  74   1          if(sKeyReskCnt == _3S_Per50MS)
  75   1          {
  76   2                Buzzer2Flag = 1;
  77   2                LongPress_3sFlag = 1;
  78   2                #if 0
                        LED1_R = 0;
                        LED2_R = 0;
                        LED3_R = 0;
                        LED4_R = 0;
                        LED1_L = 1;
                        LED2_L = 1;
                        LED3_L = 1;
                        LED4_L = 1;
                        #endif
  88   2          }
  89   1          else if(sKeyReskCnt == _5S_Per50MS)
  90   1          {
  91   2                Buzzer3Flag = 0;
  92   2                LongPress_3sFlag = 1;
  93   2                #if 0
                        LED1_R = 1;
                        LED2_R = 1;
                        LED3_R = 1;
                        LED4_R = 1;
                        LED1_L = 0;
                        LED2_L = 0;
                        LED3_L = 0;
                        LED4_L = 0;
                        #endif
 103   2          }
 104   1            
 105   1      }
 106          
 107          
 108          
 109          /*********************************************************************************************************
             -********************************* 
 110          * 函数名称: KeySelect
 111          * 功能说明: 选择按键
C51 COMPILER V9.59.0.0   KEY                                                               04/01/2024 21:04:53 PAGE 3   

 112          * 输    入: 无  
 113          * 输    出: 无
 114          * 注意事项: 短按有效
 115          **********************************************************************************************************
             -********************************/
 116            static u8 sKeyNoPress_Cnt =0;
 117          void KeySelect(void)
 118          {
 119   1        
 120   1          sKeyNoPress_Cnt = 0;
 121   1          if(NoKeyPressFalg)
 122   1          {
 123   2            if(sKeySelectCnt >0 && sKeySelectCnt < 10 )
 124   2            {
 125   3      
 126   3              ///////////////////////////按键逻辑处理//////////////////////////////
 127   3                if(LongPress_5sFlag)
 128   3                {
 129   4                  sKeyNoPress_Cnt++;
 130   4                }
 131   3                  
 132   3                else if(LongPress_3sFlag)
 133   3                {
 134   4                  sKeyNoPress_Cnt++;  
 135   4                  if(gstFilte.type == ROFilter)
 136   4                  {
 137   5                    gstFilte.type = MixFilter;
 138   5                  }
 139   4                  else
 140   4                  {
 141   5                    gstFilte.type = ROFilter;
 142   5                  }
 143   4                  Buzzer2Flag = 1;
 144   4                }     
 145   3            }
 146   2      
 147   2            
 148   2            
 149   2            sKeySelectCnt = 0;
 150   2            KeySelecetFlag = 0;
 151   2          }
 152   1            
 153   1          if(KeySelecetFlag)
 154   1          {
 155   2            sKeySelectCnt++;
 156   2          }
 157   1            
 158   1          else if(sKeySelectCnt > _10S_Per50MS || !KeySelecetFlag)
 159   1          {
 160   2              return;
 161   2          }
 162   1      }
 163          
 164          void KeyGaoYaSwitch(void)
 165          {
 166   1          if(InputKey_io == 0 && !KeySwitchFlag1)
 167   1          {
 168   2              KeySwitchFlag1 = 1;
 169   2          }
 170   1          else if(InputKey_io == 0 && KeySwitchFlag1)
 171   1          {
 172   2          
C51 COMPILER V9.59.0.0   KEY                                                               04/01/2024 21:04:53 PAGE 4   

 173   2            DLy_8616B();
 174   2              
 175   2            if(InputKey_io == 0)
 176   2            {
 177   3              KeySwitchFlag  = 1;
 178   3            }
 179   2              
 180   2            else
 181   2            {
 182   3              KeySwitchFlag1 = 0;
 183   3            }
 184   2               
 185   2          }
 186   1          else
 187   1          {
 188   2              KeySwitchFlag = 0;
 189   2              KeySwitchFlag1= 0;
 190   2          }
 191   1          
 192   1      }
 193          
 194          /*********************************************************************************************************
             -********************************* 
 195          * 函数名称: KeyProcess
 196          * 功能说明: 处理按键长按短按功能
 197          * 输    入: 无  
 198          * 输    出: 无
 199          * 注意事项: 触发时间50ms
 200          **********************************************************************************************************
             -********************************/
 201          void NoKeyProcess(void)
 202          { 
 203   1        static u8 sNoKeytCnt=0; 
 204   1        if(NoKeyPressFalg)
 205   1        {
 206   2          sNoKeytCnt++;
 207   2        }
 208   1        
 209   1          if(sNoKeytCnt > _10S_Per50MS)
 210   1          {
 211   2              LongPress_3sFlag = 0;
 212   2              LongPress_5sFlag = 0;   
 213   2          } 
 214   1        
 215   1      }
 216          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    714    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      8    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
