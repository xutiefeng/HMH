C51 COMPILER V9.59.0.0   KEY                                                               04/08/2024 14:55:08 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN ..\Output\key.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Apps\key.c LARGE OMF2 OPTIMIZE(0,SIZE) BROWSE INTVECTOR(0X1000) INCDI
                    -R(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) DEFINE(S
                    -C95F8x1xB) DEBUG PRINT(..\List\key.lst) TABS(2) OBJECT(..\Output\key.obj)

line level    source

   1          #include <SC95F8x1xB_C.H>
   2          #include  "key.h"
   3          
   4          #include "includeall.h"
   5          
   6          
   7          
   8          extern unsigned char  xdata   SOCAPI_TouchKeyStatus;          //API接口状态：bit7-一轮扫描完成标志  1:完成  0：未
             -完成
   9          extern void RestFilter(void);
  10          static u8 sKeyValue = 0;
  11          
  12          static u8 sKeyReskCnt=0;
  13          
  14          
  15          /*********************************************************************************************************
             -********************************* 
  16          * 函数名称: RestKeyProcess
  17          * 功能说明: 复位键按下，取消设置滤芯
  18          * 输    入: 无  
  19          * 输    出: 无
  20          * 注意事项:
  21          **********************************************************************************************************
             -********************************/
  22          void RestKeyProcess(void)
  23          {
  24   1          //LongPress_3sFlag = 0;
  25   1      }
  26          
  27          
  28          
  29          
  30          
  31          /*********************************************************************************************************
             -********************************* 
  32          * 函数名称: KeySelect
  33          * 功能说明: 选择按键
  34          * 输    入: 无  
  35          * 输    出: 无
  36          * 注意事项: 短按有效
  37          **********************************************************************************************************
             -********************************/
  38          extern void setLED(u8 num,emColor color ,U_LED state,u8 time);
  39          
  40          /*********************************************************************************************************
             -********************************* 
  41          * 函数名称: KeyCancelRestKey
  42          * 功能说明: 
  43          * 输    入: 无  
  44          * 输    出: 无
  45          * 注意事项: 短按有效
  46          **********************************************************************************************************
             -********************************/
C51 COMPILER V9.59.0.0   KEY                                                               04/08/2024 14:55:08 PAGE 2   

  47          void KeyCancelRestKey(void)
  48          {
  49   1        
  50   1          static u8  sCancelRestKeyCnt=0;
  51   1          static u16 sRestFilteryCnt=0;
  52   1        
  53   1          if(!RestFilterFlag)
  54   1          {
  55   2              sRestFilteryCnt = 0;
  56   2              return;
  57   2          }
  58   1          
  59   1          sRestFilteryCnt++;
  60   1          
  61   1          if((KeyCancelRestFlag )&& (sRestFilteryCnt < _5Min_Per50MS))
  62   1          {
  63   2            sCancelRestKeyCnt++;
  64   2            if(sCancelRestKeyCnt > _5S_Per50MS)
  65   2            {
  66   3                Buzzer4Flag = 1;
  67   3                KeyCancelRestFlag = 0;
  68   3                ReadEEprom(0);
  69   3                if(gstFilte.type == ROFilter)
  70   3                {
  71   4                    gstFilte.type = MixFilter;
  72   4                    setLED(1,BlueColor,blink,30);
  73   4                }
  74   3                else
  75   3                {
  76   4                    gstFilte.type = ROFilter;
  77   4                    setLED(2,BlueColor,blink,30);
  78   4                }
  79   3            }   
  80   2          }
  81   1          
  82   1      }
  83          
  84          /*********************************************************************************************************
             -********************************* 
  85          * 函数名称: KeySelect
  86          * 功能说明: 选择按键
  87          * 输    入: 无  
  88          * 输    出: 无
  89          * 注意事项: 短按有效
  90          **********************************************************************************************************
             -********************************/
  91          void KeySelect(void)
  92          {
  93   1        
  94   1          static u8 sKeySelectCnt=0;
  95   1        
  96   1          if(KeyCancelRestFlag)
  97   1          {
  98   2              KeySelecetFlag = 0;
  99   2              sKeySelectCnt = 0;
 100   2              return;
 101   2          }
 102   1          
 103   1          if(   KeySelecetFlag )//按下按键
 104   1          {
 105   2            KeySelecetFlag = 0;
 106   2            KeyRestFlag = 0;
C51 COMPILER V9.59.0.0   KEY                                                               04/08/2024 14:55:08 PAGE 3   

 107   2            sKeySelectCnt++;
 108   2          }
 109   1      
 110   1          else if(NoKeyPressFalg)//松开按键
 111   1          {
 112   2            if(sKeySelectCnt >0 && sKeySelectCnt < 10 )
 113   2            {
 114   3      
 115   3              ///////////////////////////按键逻辑处理//////////////////////////////
 116   3                if(LongPress_5sFlag)
 117   3                { 
 118   4                    LongPress_5sFlag = 0;
 119   4                    RestFilter();   
 120   4                    RestFilterFlag = 1;
 121   4                }
 122   3                  
 123   3                else if(LongPress_3sFlag)
 124   3                {
 125   4                  if(gstFilte.type == ROFilter)
 126   4                  {
 127   5                    gstFilte.type = MixFilter;
 128   5                    setLED(1,BlueColor,lightOn,0);
 129   5                  }
 130   4                  else
 131   4                  {
 132   5                    gstFilte.type = ROFilter;
 133   5                    setLED(2,BlueColor,lightOn,0);
 134   5                  }
 135   4                  Buzzer2Flag = 1;
 136   4                  
 137   4                }     
 138   3                sKeySelectCnt = 0;
 139   3                KeySelecetFlag = 0;
 140   3              }
 141   2            else
 142   2            {
 143   3                sKeySelectCnt = 0;
 144   3            }
 145   2              
 146   2      
 147   2            }
 148   1            
 149   1      }
 150          
 151          
 152          /*********************************************************************************************************
             -********************************* 
 153          * 函数名称: KeyRest
 154          * 功能说明: 长按复位键3秒，蜂鸣器短鸣一声：0.2秒
 155                      长按复位键5秒，蜂鸣器长鸣一声：2秒
 156          * 输    入: 无  
 157          * 输    出: 无
 158          * 注意事项:
 159          **********************************************************************************************************
             -********************************/
 160          void KeyRest(void)
 161          { 
 162   1          static u8 sUseFactoryCnt =0;
 163   1          static u8 sKeyReskCnt =0;//按下计时
 164   1          static u8 sKeyPressCnt =0;//按下次数
 165   1        
 166   1          if(KeyCancelRestFlag)
C51 COMPILER V9.59.0.0   KEY                                                               04/08/2024 14:55:08 PAGE 4   

 167   1          {
 168   2              KeySelecetFlag = 0;
 169   2              sKeyReskCnt = 0;
 170   2              return;
 171   2          }
 172   1      
 173   1          if(sUseFactoryCnt < 0xff)
 174   1            sUseFactoryCnt++;
 175   1          
 176   1          if(NoKeyPressFalg)
 177   1          {
 178   2      ///////////////////////////////退出工程模式////////////////////////////////////////   
 179   2            if(sKeyReskCnt >0 && sKeyReskCnt < 20 )
 180   2            {
 181   3      
 182   3            
 183   3              if(sUseFactoryCnt < _10S_Per50MS && !FactoryModeFlag) //上电10秒内    
 184   3              {
 185   4                
 186   4                sKeyPressCnt++;
 187   4                
 188   4                Buzzer3Flag = 1;
 189   4                
 190   4                if(sKeyPressCnt >4 )//复位键按五次进入工程模式
 191   4                {
 192   5                  FactoryModeFlag = 1;          
 193   5                  sKeyReskCnt = 0;
 194   5                  KeyRestFlag = 0;
 195   5                }   
 196   4              }
 197   3      
 198   3              sKeyReskCnt = 0;
 199   3              KeyRestFlag = 0;
 200   3              RestKeyProcess();//短按处理
 201   3            }
 202   2            else
 203   2            {
 204   3                sKeyReskCnt = 0;
 205   3            }
 206   2          } 
 207   1          
 208   1          if(KeyRestFlag)
 209   1          {
 210   2            KeyRestFlag = 0;
 211   2            
 212   2            sKeyReskCnt++;
 213   2          }
 214   1            
 215   1            
 216   1          else if(sKeyReskCnt > _10S_Per50MS || !KeyRestFlag)
 217   1          {
 218   2              return;
 219   2          }
 220   1              
 221   1          
 222   1          if(sKeyReskCnt == _3S_Per50MS)
 223   1          {
 224   2                Buzzer2Flag = 1;
 225   2                LongPress_5sFlag = 0;
 226   2                LongPress_3sFlag = 1;
 227   2          }
 228   1          else if(sKeyReskCnt == _5S_Per50MS)
C51 COMPILER V9.59.0.0   KEY                                                               04/08/2024 14:55:08 PAGE 5   

 229   1          {
 230   2                Buzzer5Flag = 1;
 231   2                LongPress_5sFlag = 1;
 232   2                LongPress_3sFlag = 0;
 233   2          }
 234   1            
 235   1      }
 236          
 237          /*********************************************************************************************************
             -********************************* 
 238          * 函数名称: KeyGaoYaSwitch
 239          * 功能说明: 检测高压开关闭合还是断开
 240          * 输    入: 无  
 241          * 输    出: 无
 242          * 注意事项: 短按有效
 243          **********************************************************************************************************
             -********************************/
 244          
 245          void KeyGaoYaSwitch(void)
 246          {
 247   1          if(InputKey_io == 0 && !KeySwitchFlag1)
 248   1          {
 249   2              KeySwitchFlag1 = 1;
 250   2          }
 251   1          else if(InputKey_io == 0 && KeySwitchFlag1)
 252   1          {
 253   2          
 254   2            DLy_8616B();
 255   2              
 256   2            if(InputKey_io == 0)
 257   2            {
 258   3              KeySwitchFlag  = 1;
 259   3            }
 260   2              
 261   2            else
 262   2            {
 263   3              KeySwitchFlag1 = 0;
 264   3            }
 265   2               
 266   2          }
 267   1          else
 268   1          {
 269   2              KeySwitchFlag = 0;
 270   2              KeySwitchFlag1= 0;
 271   2          }
 272   1          
 273   1      }
 274          
 275          /*********************************************************************************************************
             -********************************* 
 276          * 函数名称: KeyProcess
 277          * 功能说明: 处理按键长按短按功能
 278          * 输    入: 无  
 279          * 输    出: 无
 280          * 注意事项: 触发时间50ms
 281          **********************************************************************************************************
             -********************************/
 282          void NoKeyProcess(void)
 283          { 
 284   1          static u8 sNoKeytCnt=0; 
 285   1        
 286   1          if(NoKeyPressFalg)
C51 COMPILER V9.59.0.0   KEY                                                               04/08/2024 14:55:08 PAGE 6   

 287   1          {
 288   2            sNoKeytCnt++;
 289   2            
 290   2          }
 291   1          else
 292   1          {
 293   2            sNoKeytCnt = 0;
 294   2          }
 295   1        
 296   1          if(sNoKeytCnt > _10S_Per50MS)
 297   1          {
 298   2              LongPress_3sFlag = 0;
 299   2              LongPress_5sFlag = 0;   
 300   2              
 301   2          } 
 302   1        
 303   1      }
 304          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1035    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     10    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
