C51 COMPILER V9.59.0.0   MAIN                                                              03/20/2024 20:54:38 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\Output\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\User\main.c LARGE OMF2 OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0X2800) INCD
                    -IR(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) DEFINE(
                    -SC95F8x1xB) DEBUG PRINT(..\List\main.lst) TABS(2) OBJECT(..\Output\main.obj)

line level    source

   1          //************************************************************
   2          //  Copyright (c)  
   3          //  FileName    : main.c
   4          //  Function    : Main Function
   5          //  Instructions  : Contains the MCU initialization function and its H file
   6          //************************************************************
   7          /********************Includes************************************************************************/
   8          #include "SC_Init.h"  // MCU initialization header file, including all firmware library header files
   9          #include "SC_it.h"
  10          #include "..\Drivers\SCDriver_list.h"
  11          #include "HeadFiles\SysFunVarDefine.h"
  12          #include "..\Apps\includeall.h"
  13          
  14          extern void CMP_Init(void);
  15          unsigned long int exKeyValueFlag;
  16          uint16_t gAD_Value1,gAD_Value2,gAD_Value3,gAD_Value4;
  17          uint8_t gPWMOnOff ;
  18          uint8_t KEY_test;
  19          
  20          /**************************************Generated by EasyCodeCube*************************************/
  21          //Forbid editing areas between the labels !!!
  22          
  23          /*************************************.Generated by EasyCodeCube.************************************/
  24          
  25          
  26          /*****************************************************************************************************
  27          * Function Name: main
  28          * Description  : This function implements main function.
  29          * Arguments    : None
  30          * Return Value : None
  31          ******************************************************************************************************/
  32          void main(void)
  33          { 
  34   1      #if(LDROM_MODE==0)
  35   1          SetInterruptAPP();
  36   1      #endif
  37   1          /*<Generated by EasyCodeCube begin>*/
  38   1          /*<UserCodeStart>*//*<SinOne-Tag><36>*/
  39   1          IcResourceInit();
  40   1          /*<UserCodeEnd>*//*<SinOne-Tag><36>*/
  41   1          /*<UserCodeStart>*//*<SinOne-Tag><60>*/
  42   1          OTA_Init(IOT_Uart_Receiver,&IOT_Uart_DataBuf);
  43   1          IOT_Init(0);
  44   1          TouchKeyInit();
  45   1          sysRest();
*** WARNING C206 IN LINE 45 OF ..\User\main.c: 'sysRest': missing function-prototype
  46   1          EEpromInit();
  47   1          while(gstRDsysTick.tickCnt < 200)
  48   1          {
  49   2              ;
  50   2          }
  51   1          CMP_Init();
  52   1          
C51 COMPILER V9.59.0.0   MAIN                                                              03/20/2024 20:54:38 PAGE 2   

  53   1          /*<UserCodeEnd>*//*<SinOne-Tag><60>*/
  54   1          /*<UserCodeStart>*//*<SinOne-Tag><4>*/
  55   1          /*****MainLoop*****/
  56   1          //WriteTempEeprom();
  57   1          while(1)
  58   1          {
  59   2              /*<UserCodeStart>*//*<SinOne-Tag><14>*/
  60   2              /***User program***/
  61   2              WDTCON |=0x10;
  62   2              
  63   2              if(IOT_GET_FW==IOT_Work())                        //IOT平台交互命令处理
  64   2              {
  65   3      #if(FIRMWARE_DOWMLOADER_MODE==0) //在BOOT中下载固件
                          OTA_JumpBoot();             //复位到BOOT，在BOOT中下载固件并更新到APP区
              #endif
  68   3              }
  69   2              
  70   2      #if(FIRMWARE_DOWMLOADER_MODE==1)
  71   2              OTA_FirmwareDownload(&IAP_Pack);   //从IOT平台下载固件
  72   2              
  73   2              if(IAP_Pack.Size!=0)                       //完成一包数据接收
  74   2              {
  75   3                  unsigned int IapLen;
  76   3                  BootLoadInit();                         //开放IAP操作区域
  77   3                  IapLen=SaveOTA_to_BacksArea(&IAP_Pack); //将APP写入备份区
  78   3                  if(IapLen!=0)                           //写入成功
  79   3                  {
  80   4                      IAP_Pack.State=OTA_IAPWRITED;
  81   4                  }
  82   3                  else
  83   3                  {
  84   4                      IAP_Pack.State=OTA_FAULT;             //下载失败
  85   4                  }
  86   3                  IAP_Pack.Size=0;
  87   3                  BootLoad_DeInit();                        //恢复IAP操作区域
  88   3              }     
  89   2              if(IAP_Pack.State==OTA_COMPLETE)     //下载完成是，IAP_Pack.State置为OTA_COMPLETE状态
  90   2              {
  91   3                  BootLoadInit();                   //开放IAP操作区域
  92   3                  if (!IAP_BacksArea_CrcCheck())    //检查下载到备份区代码的Crc       
  93   3                  {
  94   4                      BootLoad_DeInit();            //恢复IAP操作区域
  95   4                      IAP_Pack.State=OTA_FAULT;     //下载失败
  96   4                  }
  97   3                  else                              //校验通过
  98   3                  {
  99   4                      BootLoad_DeInit();            //恢复IAP操作区域
 100   4                      OTA_JumpBoot();             //复位到BOOT，将备份区更新到APP区
 101   4                  }
 102   3              } 
 103   2              
 104   2              if(IAP_Pack.State==OTA_FAULT)  //出错处理
 105   2              {
 106   3                  OTA_Init(IOT_Uart_Receiver,&IOT_Uart_DataBuf);
 107   3                  IOT_Init(0);
 108   3              }   
 109   2      #endif
 110   2      #if 1         
 111   2              if(SOCAPI_TouchKeyStatus & 0x80)
 112   2              {
 113   3                  SOCAPI_TouchKeyStatus &= 0x7f;
 114   3                  exKeyValueFlag = TouchKeyScan();
C51 COMPILER V9.59.0.0   MAIN                                                              03/20/2024 20:54:38 PAGE 3   

 115   3                  if(exKeyValueFlag >0)
 116   3                  { 
 117   4                      NoKeyPressFalg = 0;
 118   4                      if(exKeyValueFlag&0x02ul)
 119   4                      {
 120   5                          KeyRestFlag = 1;
 121   5                      }
 122   4                      exKeyValueFlag>>=8;
 123   4                      if(exKeyValueFlag&0x40ul)
 124   4                      {
 125   5                          KeySelecetFlag  = 1;
 126   5                      }
 127   4                      
 128   4                      
 129   4                      
 130   4                  }
 131   3                  else
 132   3                  {
 133   4                      NoKeyPressFalg = 1;
 134   4                  }
 135   3                  
 136   3                  TouchKeyRestart();
 137   3              }
 138   2      #endif
 139   2      #if 0
                      ADC_ChannelConfig(ADC_CHANNEL_1,ENABLE);
                      
                      gAD_Value4 = ADC_GetConversionAverageValue(10);
                      
                      ADC_ChannelConfig(ADC_CHANNEL_3,ENABLE);
                      gAD_Value1 = ADC_GetConversionAverageValue(10);
                      
                      ADC_ChannelConfig(ADC_CHANNEL_5,ENABLE);
                      gAD_Value2 = ADC_GetConversionAverageValue(10);
                      
                      ADC_ChannelConfig(ADC_CHANNEL_7,ENABLE);
                      gAD_Value3 = ADC_GetConversionAverageValue(10);
                      
              #endif
 154   2      #if 0
                      if( KEY_test)//gPWMOnOff
                      {
                          LED1_R = 1;
                          LED2_R = 1;
                          LED3_R = 1;
                          LED4_R = 1;
                          LED1_L = 0;
                          LED2_L = 0;
                          LED3_L = 0;
                          LED4_L = 0;
                          
                      }
                      else
                      {
                          
                          LED1_R = 0;
                          LED2_R = 0;
                          LED3_R = 0;
                          LED4_R = 0;
                          LED1_L = 1;
                          LED2_L = 1;
                          LED3_L = 1;
C51 COMPILER V9.59.0.0   MAIN                                                              03/20/2024 20:54:38 PAGE 4   

                          LED4_L = 1;
                      }
              #endif 
 180   2              
 181   2      #if 0
                      if(P05 == 0)
                      {
                          BuzzerFlag =  1;
                          //PWM_IndependentModeConfig(PWM02,2000);
                      }
                      else
                      {
                          //PWM_IndependentModeConfig(PWM02,0);
                      }
                      
              #endif
 193   2      #if 1
 194   2              sysRuning();
*** WARNING C206 IN LINE 194 OF ..\User\main.c: 'sysRuning': missing function-prototype
 195   2      #endif
 196   2              
 197   2              if((CMPCON&0x20)|| KEY_test==0x5A )    //判断模拟器输出状态
 198   2              {
 199   3                  KEY_test &= ~0X5A;
 200   3                  WriteTempEeprom();
*** WARNING C206 IN LINE 200 OF ..\User\main.c: 'WriteTempEeprom': missing function-prototype
 201   3                  BuzzerFlag =  1;
 202   3              } 
 203   2      #if 0
                      else
                      {
                          if(readEEprom(EEPROM_ADDR) == 0)
                          {
                              LED1_L =1;
                              LED2_L =0;
                              LED3_L =0;
                              LED4_L =0;
                          }
                          else if(readEEprom(EEPROM_ADDR) == 1)
                          {
                              LED1_L =0;
                              LED2_L =1;
                              LED3_L =0;
                              LED4_L =0;
                          }
                          else if(readEEprom(EEPROM_ADDR) == 2)
                          {
                              LED1_L =0;
                              LED2_L =0;
                              LED3_L =1;
                              LED4_L =0;
                          }
                          else
                          {
                              LED1_L =0;
                              LED2_L =0;
                              LED3_L =0;
                              LED4_L =1;
                              
                          }
                          
                      }
C51 COMPILER V9.59.0.0   MAIN                                                              03/20/2024 20:54:38 PAGE 5   

              #endif
 238   2              /*<UserCodeEnd>*//*<SinOne-Tag><14>*/
 239   2              /*<Begin-Inserted by EasyCodeCube for Condition>*/
 240   2          }
 241   1          /*<UserCodeEnd>*//*<SinOne-Tag><4>*/
 242   1          /*<Generated by EasyCodeCube end>*/
 243   1      }
 244          
 245          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    355    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     14       2
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
