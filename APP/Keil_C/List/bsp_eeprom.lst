C51 COMPILER V9.59.0.0   BSP_EEPROM                                                        03/27/2024 21:25:07 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE BSP_EEPROM
OBJECT MODULE PLACED IN ..\Output\bsp_eeprom.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Apps\bsp_eeprom.c LARGE OMF2 OPTIMIZE(0,SIZE) BROWSE INTVECTOR(0X1000
                    -) INCDIR(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) D
                    -EFINE(SC95F8x1xB) DEBUG PRINT(..\List\bsp_eeprom.lst) TABS(2) OBJECT(..\Output\bsp_eeprom.obj)

line level    source

   1          
   2          
   3          #include <string.h>
   4          #include "bsp_eeprom.h"
   5          #include "globe.h"
   6          
   7          #define WriteToEEprom(X)          WriteEEpromData(EEPROM##X##_ADDR,gstAM901.stFilter,EEPROM_DATA_LEN) 
   8          #define ReadFromEEprom(X)         IAP_ReadByteArray(EEPROM##X##_ADDR,(u8 *)gstAM901.stFilter,EEPROM_DATA_LEN,
             -IAP_MEMTYPE_EEPROM)
   9          #define EraseEEprom(X)            IAP_EEPROMSectorEraseOption(EEPROM##X##_ADDR)
  10          
  11          #define EEPROM_DATA_LEN 4
  12          #define Block_Size 0XFFff
  13          /**************************************************
  14          *函数名称:void IAP_SectorEraseOption(Address,Data,IAP_MemType)
  15          *函数功能:IAP扇区擦除
  16          *入口参数:uint32_t:Address:IAP操作地址
  17          *         IAP_MemType_TypeDef:IAP_MemType:IAP操作对象
  18          *出口参数:void
  19          **************************************************/
  20          
  21          u8 testAyy[]={0x60,0x33,0x99,0x90,0x90,0x90,0xD5,0xFA};
  22          #define _INIT_DADA 0x5b
  23          #define  EEPROM0_ADDR 0ul
  24          #define  EEPROM1_ADDR 0x200UL
  25          #define  EEPROM2_ADDR 0x400UL
  26          #define  EEPROM3_ADDR 0x600UL
  27          #define EEPROM_SIZE 0XFFFF
  28          
  29          static u8 FromEeppAry[8];
  30          
  31          
  32          u8 WriteEEpromData(u32 x,u8 *p,u8 len)
  33          {
  34   1        u8 i ,FromEepromData;
  35   1        u8 *pData = p;
  36   1          
  37   1        
  38   1        
  39   1        for(i= 0;i < len; i++)
  40   1        {
  41   2          loop:   
  42   2          IAP_EEPROMProgramByteOption(x+i,pData[i]);
  43   2          FromEepromData =IAP_ReadByte(x+i,IAP_MEMTYPE_EEPROM);
  44   2          if(FromEepromData != pData[i] )
  45   2            goto loop;
  46   2        }
  47   1        return 1;
  48   1      }
  49          
  50          
  51          
  52          
C51 COMPILER V9.59.0.0   BSP_EEPROM                                                        03/27/2024 21:25:07 PAGE 2   

  53          void WriteTempEeprom(void)
  54          {
  55   1        //IAP_ReadByteArray(EEPROM_ADDR,FromEeppAry,8,IAP_MEMTYPE_EEPROM);
  56   1        if(!gstAM901.Run.Bit.EepromBlok )
  57   1        {
  58   2            gstAM901.stFilter->type++;
  59   2            if(WriteToEEprom(0) == 0)
*** WARNING C182 IN LINE 59 OF ..\Apps\bsp_eeprom.c: pointer to different objects
  60   2            {
  61   3                if(WriteToEEprom(0) == 0)
*** WARNING C182 IN LINE 61 OF ..\Apps\bsp_eeprom.c: pointer to different objects
  62   3                {
  63   4                    if(WriteToEEprom(0) == 0)
*** WARNING C182 IN LINE 63 OF ..\Apps\bsp_eeprom.c: pointer to different objects
  64   4                    {
  65   5                        WriteToEEprom(1);
*** WARNING C182 IN LINE 65 OF ..\Apps\bsp_eeprom.c: pointer to different objects
  66   5                    }
  67   4      
  68   4                }
  69   3            }
  70   2        }
  71   1         
  72   1        else
  73   1        {
  74   2            gstAM901.stFilter->type  = 0;
  75   2            WriteToEEprom(1);
*** WARNING C182 IN LINE 75 OF ..\Apps\bsp_eeprom.c: pointer to different objects
  76   2        }
  77   1          
  78   1      
  79   1      
  80   1      //while(1);
  81   1      }
  82          
  83          
  84          u8 readEEprom(u32 x)
  85          {
  86   1         IAP_ReadByteArray(x,(u8 *)gstAM901.stFilter,EEPROM_DATA_LEN,IAP_MEMTYPE_EEPROM);
  87   1         return gstAM901.stFilter->type;
  88   1      }
  89          
  90          /*********************************************************************************************************
             -********************************* 
  91          * 函数名称:  ReadTempEeprom
  92          * 功能说明:  读取EEPROM接口
  93          * 输    入: 无  
  94          * 输    出: 无
  95          **********************************************************************************************************
             -********************************/
  96          
  97          
  98          
  99          void EEpromInit(void)
 100          {
 101   1          if(ReadFromEEprom(0) == 0)
 102   1          {
 103   2              ReadFromEEprom(0);
 104   2          }
 105   1          if(gstAM901.stFilter->type< EEPROM_SIZE)
 106   1          {
 107   2              gstAM901.Run.Bit.EepromBlok = 0;
C51 COMPILER V9.59.0.0   BSP_EEPROM                                                        03/27/2024 21:25:07 PAGE 3   

 108   2              EraseEEprom(0);
 109   2              return;
 110   2          }
 111   1          else
 112   1          {
 113   2              if(ReadFromEEprom(1) == 0)
 114   2              {
 115   3                  ReadFromEEprom(1);
 116   3              }
 117   2          }
 118   1          
 119   1          if(gstAM901.stFilter->type < EEPROM_SIZE)//5a 表示上一次用的是EEPROM_ADDR 块，标记成F5;这一次用EEPROM1_
             -ADDR
 120   1          {
 121   2              gstAM901.Run.Bit.EepromBlok = 1;//gstAM901.Run.Bit.EepromBlok = 1;
 122   2              EraseEEprom(1);//EraseEEprom(1);
 123   2          }
 124   1          else//首次使用
 125   1          {
 126   2                gstAM901.Run.Bit.EepromBlok = 0;
 127   2                //EraseEEprom(0);
 128   2                EraseEEprom(1);
 129   2                memset((u8 *)gstAM901.stFilter,0,EEPROM_DATA_LEN);
 130   2                FirstPownOnFlag = 1;
 131   2          }
 132   1      }
 133          
 134          
 135          
 136          /*********************************************************************************************************
             -********************************* 
 137          * 函数名称:  BSP_EEPROM_Initialize
 138          * 功能说明:  初始化EEPROM
 139          * 输    入: 无  
 140          * 输    出: 无
 141          **********************************************************************************************************
             -********************************/
 142          void BSP_EEPROM_Initialize ( void )
 143          {
 144   1          
 145   1        
 146   1      }
 147          
 148          
 149          
 150          
 151          /*********************************************************************************************************
             -********************************* 
 152          * 函数名称: EepromProcess
 153          * 功能说明: 每个100ms检测一次，是否有开机状态变化，温度设置的变化
 154          * 输    入: 无  
 155          * 输    出: 无
 156          **********************************************************************************************************
             -********************************/
 157          void EepromProcess(void)
 158          {
 159   1          
 160   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    669    ----
C51 COMPILER V9.59.0.0   BSP_EEPROM                                                        03/27/2024 21:25:07 PAGE 4   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     29    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  5 WARNING(S),  0 ERROR(S)
