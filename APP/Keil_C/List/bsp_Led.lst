C51 COMPILER V9.59.0.0   BSP_LED                                                           04/07/2024 19:40:23 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE BSP_LED
OBJECT MODULE PLACED IN ..\Output\bsp_Led.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Apps\bsp_Led.c LARGE OMF2 OPTIMIZE(0,SIZE) BROWSE INTVECTOR(0X1000) I
                    -NCDIR(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) DEFI
                    -NE(SC95F8x1xB) DEBUG PRINT(..\List\bsp_Led.lst) TABS(2) OBJECT(..\Output\bsp_Led.obj)

line level    source

   1          #include "..\Apps\bsp_Led.h"
   2          #include "..\Apps\includeall.h"
   3          
   4          
   5          void CloseAllLED(void)
   6          {
   7   1        led1_io = 1;
   8   1        led2_io = 1;
   9   1        led3_io = 1;
  10   1        led4_io = 1;
  11   1      }
  12          
  13          void LED_sCan(void)
  14          { 
  15   1        if(gbFlagData[3].all ==0 )
  16   1        {
  17   2          Chanel_IO1 = 0;
  18   2          Chanel_IO2 = 0;
  19   2          
  20   2          return;
  21   2        }
  22   1        CloseAllLED();
  23   1        if(LedChangeFlag)
  24   1        {
  25   2          LedChangeFlag = 0;
  26   2          Chanel_IO1 = 1;
  27   2          Chanel_IO2 = 0;
  28   2          if(LED1_L)
  29   2          {
  30   3            led1_io = 0;
  31   3          }
  32   2          
  33   2          if(LED2_L)
  34   2          {
  35   3            led2_io = 0;
  36   3          }
  37   2      
  38   2          if(LED3_L)
  39   2          {
  40   3            led3_io = 0;
  41   3          }
  42   2          
  43   2          if(LED4_L)
  44   2          {
  45   3            led4_io = 0;
  46   3          }
  47   2        }
  48   1        else
  49   1        {
  50   2          LedChangeFlag = 1;
  51   2      
  52   2          Chanel_IO1 = 0;
  53   2          Chanel_IO2 = 1;
C51 COMPILER V9.59.0.0   BSP_LED                                                           04/07/2024 19:40:23 PAGE 2   

  54   2          
  55   2        
  56   2          if(LED1_R)
  57   2          {
  58   3            led1_io = 0;
  59   3          }
  60   2          if(LED2_R)
  61   2          {
  62   3            led2_io = 0;
  63   3          }
  64   2          
  65   2           if(LED3_R)
  66   2          {
  67   3            led3_io = 0;
  68   3          }
  69   2          
  70   2           if(LED4_R)
  71   2          {
  72   3            led4_io = 0;
  73   3          }
  74   2        } 
  75   1      }
  76          
  77          
  78          
  79          typedef struct
  80          {
  81              union
  82              {
  83                  u8 all;
  84                  struct
  85                  {
  86                    u8 lednum :2;
  87                    u8 time   :6;
  88                  }Bit;
  89              }run;
  90              u8 lednum;//哪个灯
  91              emColor color;  //什么颜色
  92              U_LED action;//需要执行什么状态，常亮？或者闪烁 
  93          }ST_LED;
  94          
  95          ST_LED gstLed;
  96          
  97          void setLED(u8 num,emColor color ,U_LED state,u8 time)
  98          {
  99   1          u8 temp_bit ;
 100   1          u8 temp_bit2;
 101   1          if(gstLed.action == blink)
 102   1            return;
 103   1          
 104   1          gstLed.run.Bit.lednum = num-1;
 105   1          gstLed.run.Bit.time   = time;
 106   1          gstLed.color =  color;
 107   1          gstLed.action = state;
 108   1          
 109   1          
 110   1          if(gstLed.color == BlueColor)
 111   1          {
 112   2            temp_bit2 =1<<(gstLed.run.Bit.lednum+4);
 113   2            temp_bit = 1<<(gstLed.run.Bit.lednum);
 114   2          }
 115   1          else
C51 COMPILER V9.59.0.0   BSP_LED                                                           04/07/2024 19:40:23 PAGE 3   

 116   1          {
 117   2            temp_bit2 = 1<<(gstLed.run.Bit.lednum);
 118   2            temp_bit = 1<<(gstLed.run.Bit.lednum+4);
 119   2            
 120   2          }
 121   1          if( gstLed.action == lightOn)
 122   1            gbFlagData[3].all |=temp_bit2;
 123   1          else
 124   1            gbFlagData[3].all &=~temp_bit2;
 125   1      }
 126          
 127          
 128          
 129            
 130          void LED_Process(void)
 131          {
 132   1      
 133   1        u8 temp_bit = 0;
 134   1      
 135   1        
 136   1        if(gstLed.action == blink)
 137   1        {
 138   2            
 139   2          if(gstLed.run.Bit.time > 0)
 140   2          {
 141   3              gstLed.run.Bit.time--;
 142   3              
 143   3              if(gstLed.run.Bit.time %5 == 0)
 144   3              {
 145   4                if(gstLed.color == BlueColor)
 146   4                {
 147   5                  temp_bit =1<<(gstLed.run.Bit.lednum+4);
 148   5                }
 149   4                else
 150   4                {
 151   5                  temp_bit =1<<(gstLed.run.Bit.lednum);
 152   5                }
 153   4              
 154   4                  if(gbFlagData[3].all&temp_bit)
 155   4                {
 156   5                  gbFlagData[3].all &=~temp_bit;
 157   5                }
 158   4                else
 159   4                  {
 160   5                  gbFlagData[3].all |=temp_bit;
 161   5                }      
 162   4              }
 163   3          }     
 164   2          else
 165   2          {
 166   3              gstLed.action  = lightOn;
 167   3          }
 168   2            
 169   2          
 170   2        }
 171   1      
 172   1        if(BlueLedFlag)
 173   1        {
 174   2          Blueled_io = 1;
 175   2        }
 176   1        else
 177   1        {
C51 COMPILER V9.59.0.0   BSP_LED                                                           04/07/2024 19:40:23 PAGE 4   

 178   2          Blueled_io = 0;
 179   2        }
 180   1        
 181   1        if(RedLedtFlag)
 182   1        {
 183   2          Redled_io = 1;
 184   2        }
 185   1        else
 186   1        {
 187   2          Redled_io = 0;
 188   2        }
 189   1          
 190   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    738    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     11    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
