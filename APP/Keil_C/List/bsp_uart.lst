C51 COMPILER V9.59.0.0   BSP_UART                                                          04/08/2024 14:09:42 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE BSP_UART
OBJECT MODULE PLACED IN ..\Output\bsp_uart.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Apps\bsp_uart.c LARGE OMF2 OPTIMIZE(0,SIZE) BROWSE INTVECTOR(0X1000) 
                    -INCDIR(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) DEF
                    -INE(SC95F8x1xB) DEBUG PRINT(..\List\bsp_uart.lst) TABS(2) OBJECT(..\Output\bsp_uart.obj)

line level    source

   1          
   2          
   3          #include "bsp_uart.h"
   4          
   5          
   6          
   7          #define   HEAD_CODE_NORMAL          0x03  
   8          #define   HEAD_CODE_EVENT           0x06  
   9          #define   ZHUKONGBAN_ADDR           0X01
  10          #define   RX_Len                              0X05
  11          
  12          //uint8_t     SCICheckout;                             
  13          //uint8_t     RxLen; 
  14          
  15          #define ReceiveRestart()   RxLen = 0, SCICheckout  = 0
  16          #define RECEIVE_CONTROLLER_DATA_LENGTH 2
  17          
  18          const unsigned  char  code  display_tab[]=                     
  19          {
  20            0x3f,//0
  21            0x06,//1
  22            0x5b,//2
  23            0x4f,//3  
  24            0x66,//4 
  25            0x6d,//5
  26            0x7d,//6
  27            0x07,//7
  28            0x7f, //8
  29            0x6f,//9
  30            0x77,//a
  31            0x7c, //b 
  32            0x39,//c 
  33            0x5e,//d
  34            0x79, //e
  35            0x71, //F
  36          };
  37          /*
  38          此函数
  39          */
  40          
  41          
  42          
  43          void display_value(u16 v,u8 type)
  44          {
  45   1          switch(type)
  46   1          {
  47   2            case 0:
  48   2              gSendData[2].all = (v>>8)&0x0f;
  49   2              gSendData[2].all = display_tab[gSendData[2].all];
  50   2            
  51   2              gSendData[3].all = (v>>4)&0x0f;
  52   2              gSendData[3].all = display_tab[gSendData[3].all];
  53   2            
C51 COMPILER V9.59.0.0   BSP_UART                                                          04/08/2024 14:09:42 PAGE 2   

  54   2              gSendData[4].all = v&0x0f;
  55   2              gSendData[4].all = display_tab[gSendData[4].all];
  56   2            break;
  57   2            
  58   2            case 1:
  59   2              
  60   2              if(v > 999)
  61   2                v= 999;
  62   2              
  63   2              gSendData[2].all = v/100; 
  64   2              gSendData[2].all = display_tab[gSendData[2].all];
  65   2              gSendData[3].all = (v/10)%10;
  66   2              gSendData[3].all = display_tab[gSendData[3].all];
  67   2              gSendData[4].all = v%10;
  68   2              gSendData[4].all = display_tab[gSendData[4].all];
  69   2            break;
  70   2            
  71   2            default:
  72   2              break;
  73   2          
  74   2          }
  75   1      }
  76          void ShuMaGuanDisplay(u16 ad_v)
  77          {
  78   1        
  79   1          display_value((u16)ad_v,1);
  80   1      }
  81          
  82          
  83          
  84          
  85          
  86          
  87          
  88          
  89          u8 TDS_ZhiShi_display(void)
  90          {
  91   1        static u8 sFactoryModeCnt =0;
  92   1        uLED_Dliaplay Udata;
  93   1        Udata.all =0;
  94   1        if(FactoryModeFlag || FstModeFlag)
  95   1        {
  96   2            if(sFactoryModeCnt++ >_20S_Per100MS )
  97   2            {
  98   3                sFactoryModeCnt = 0;
  99   3                
 100   3            }
 101   2            if(sFactoryModeCnt < _10S_Per100MS)
 102   2            {
 103   3                ShuMaGuanDisplay(gstADCollect.tds_ChunShui);
 104   3                Udata.Bit.Water =1;
 105   3            }
 106   2            else
 107   2            {
 108   3                ShuMaGuanDisplay(gstADCollect.tds_YuanShui);  
 109   3                Udata.Bit.Water = 0;
 110   3            }
 111   2        }
 112   1        else
 113   1        {
 114   2            ShuMaGuanDisplay(gstADCollect.tds_ChunShui);
 115   2            
C51 COMPILER V9.59.0.0   BSP_UART                                                          04/08/2024 14:09:42 PAGE 3   

 116   2        } 
 117   1        
 118   1           if(LED2_L)
 119   1           {      
 120   2              Udata.Bit.RO = 1;
 121   2           }
 122   1           else if(LED2_R)
 123   1           {
 124   2              Udata.Bit.RO = 2;
 125   2           }
 126   1           else
 127   1           {
 128   2              Udata.Bit.RO = 0;
 129   2           }
 130   1      
 131   1          
 132   1           if(LED1_L)
 133   1           {        
 134   2               Udata.Bit.ppc = 1;
 135   2           }
 136   1           else if(LED1_R)
 137   1           {
 138   2              Udata.Bit.ppc = 2;
 139   2           }
 140   1           else
 141   1           {
 142   2              Udata.Bit.ppc = 0;
 143   2           }
 144   1        
 145   1        return Udata.all;
 146   1          
 147   1          
 148   1      }
 149          
 150          void  ZhiShiDengdisplay2(void)//龙头指示灯2
 151          {
 152   1          
 153   1      }
 154          
 155          void    UART0_SendData( void)
 156          {
 157   1          u8 i;
 158   1          
 159   1          
 160   1          gSendData[0].all = 0xA5;
 161   1          gSendData[1].all = 8;
 162   1          
 163   1          gSendData[5].all  = TDS_ZhiShi_display();
 164   1          //gSendData[6].Bit.b0 = ShuiLongTouOpen;
 165   1          gSendData[6].Bit.b1 = gSendData[5].Bit.b6;//chun shui
 166   1          gSendData[7].all = 0;
 167   1          for(i = 0;i<7;i++)
 168   1          {
 169   2              gSendData[7].all +=gSendData[i].all;
 170   2          }
 171   1          
 172   1          SBUF = 0xA5;
 173   1      }
 174          
 175          
 176          
 177          
C51 COMPILER V9.59.0.0   BSP_UART                                                          04/08/2024 14:09:42 PAGE 4   

 178          void    RDUART0_RcvByte(void)
 179          {
 180   1          u8   temp;
 181   1          static u8 RxLen;
 182   1          static u8 SCICheckout;
 183   1          static u8 rx[8];
 184   1         
 185   1              temp = SBUF;
 186   1              if(RxLen == 0)
 187   1              {
 188   2                if((temp == 0Xa5))
 189   2                {
 190   3                  rx[0] = temp;
 191   3                  SCICheckout += temp;
 192   3                  RxLen++;
 193   3                }
 194   2                else
 195   2                {
 196   3                   ReceiveRestart();
 197   3                }
 198   2              }
 199   1        
 200   1              else if(RxLen == 7)
 201   1              {
 202   2                if(temp ==  SCICheckout)
 203   2                {
 204   3           
 205   3                    if(rx[2] >0 )
 206   3                    {
 207   4                        ShuiLongTouOpen=1;
 208   4      
 209   4                    }
 210   3                      
 211   3                    else
 212   3                    {
 213   4                        ShuiLongTouOpen=0;
 214   4                    }
 215   3                    PanelLostFlag = 0;
 216   3                  
 217   3                    ReceiveRestart();
 218   3                }           
 219   2                else
 220   2                {           
 221   3                   ReceiveRestart();
 222   3                }
 223   2              }
 224   1              
 225   1              else
 226   1              {
 227   2                rx[RxLen] = temp;
 228   2                RxLen++;
 229   2                SCICheckout += temp;
 230   2              }
 231   1      }
 232          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    939    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =     19    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.59.0.0   BSP_UART                                                          04/08/2024 14:09:42 PAGE 5   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
