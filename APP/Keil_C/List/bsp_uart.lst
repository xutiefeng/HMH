C51 COMPILER V9.59.0.0   BSP_UART                                                          03/27/2024 21:25:07 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE BSP_UART
OBJECT MODULE PLACED IN ..\Output\bsp_uart.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Apps\bsp_uart.c LARGE OMF2 OPTIMIZE(0,SIZE) BROWSE INTVECTOR(0X1000) 
                    -INCDIR(..\FWLib\SC95F_Lib\inc;..\User;..\IOT_DRIVER\XIAOMI;..\Drivers;..\Drivers\TKDriver\C;..\List\..\Apps;..\Apps) DEF
                    -INE(SC95F8x1xB) DEBUG PRINT(..\List\bsp_uart.lst) TABS(2) OBJECT(..\Output\bsp_uart.obj)

line level    source

   1          
   2          
   3          #include "bsp_uart.h"
   4          
   5          
   6          
   7          #define   HEAD_CODE_NORMAL          0x03  
   8          #define   HEAD_CODE_EVENT           0x06  
   9          #define   ZHUKONGBAN_ADDR           0X01
  10          #define   RX_Len                              0X05
  11          
  12          //uint8_t     SCICheckout;                             
  13          //uint8_t     RxLen; 
  14          
  15          #define ReceiveRestart()   RxLen = 0, SCICheckout  = 0
  16          #define RECEIVE_CONTROLLER_DATA_LENGTH 2
  17          
  18          const unsigned  char  code  display_tab[]=                     
  19          {
  20            0x3f,//0
  21            0x06,//1
  22            0x5b,//2
  23            0x4f,//3  
  24            0x66,//4 
  25            0x6d,//5
  26            0x7d,//6
  27            0x07,//7
  28            0x7f, //8
  29            0x6f,//9
  30            0x77,//a
  31            0x7c, //b 
  32            0x39,//c 
  33            0x5e,//d
  34            0x79, //e
  35            0x71, //F
  36          };
  37          /*
  38          ´Ëº¯Êý
  39          */
  40          
  41          void ShuMaGuanDisplay(void)
  42          {
  43   1          gSendData[2].all = (gstADCollect.fChunShui>>8)&0x0f;
  44   1          gSendData[2].all = display_tab[gSendData[2].all];
  45   1        
  46   1          gSendData[3].all = (gstADCollect.fChunShui>>4)&0x0f;
  47   1          gSendData[3].all = display_tab[gSendData[3].all];
  48   1        
  49   1          gSendData[4].all = gstADCollect.fChunShui&0x0f;
  50   1          gSendData[4].all = display_tab[gSendData[4].all];
  51   1      }
  52          
  53          
C51 COMPILER V9.59.0.0   BSP_UART                                                          03/27/2024 21:25:07 PAGE 2   

  54          void    UART0_SendData( void)
  55          {
  56   1          u8 i;
  57   1          
  58   1          gSendData[0].all = 0xA5;
  59   1          gSendData[1].all = 8;
  60   1        
  61   1          gSendData[5].all = 0;   
  62   1          gSendData[6].all = 3;
  63   1          ShuMaGuanDisplay();
  64   1          gSendData[7].all = 0;
  65   1          
  66   1          for(i = 0;i<7;i++)
  67   1          {
  68   2              gSendData[7].all +=gSendData[i].all;
  69   2          }
  70   1          
  71   1          SBUF = 0xA5;
  72   1      }
  73          
  74          
  75          
  76          
  77          void    RDUART0_RcvByte(void)
  78          {
  79   1          u8   temp;
  80   1          static u8 RxLen;
  81   1          static u8 SCICheckout;
  82   1          static u8 rx[8];
  83   1          //LPUART_Getchar(LPUART0, &temp);
  84   1         
  85   1              temp = SBUF;
  86   1              if(RxLen == 0)
  87   1              {
  88   2                if((temp == 0Xa5))
  89   2                {
  90   3                  rx[0] = temp;
  91   3                  SCICheckout += temp;
  92   3                  RxLen++;
  93   3                }
  94   2                else
  95   2                {
  96   3                   ReceiveRestart();
  97   3                }
  98   2              }
  99   1        
 100   1              else if(RxLen == 7)
 101   1              {
 102   2                if(temp ==  SCICheckout)
 103   2                {
 104   3           
 105   3                    if(rx[2] >0 )
 106   3                    {
 107   4                        ShuiLongTouOpen=1;
 108   4                        ShuiLongTouClose=0;
 109   4                    }
 110   3                      
 111   3                    else
 112   3                    {
 113   4                        ShuiLongTouOpen=0;
 114   4                        ShuiLongTouClose=1;
 115   4                    }
C51 COMPILER V9.59.0.0   BSP_UART                                                          03/27/2024 21:25:07 PAGE 3   

 116   3                    PanelLostFlag = 0;
 117   3                  
 118   3                    ReceiveRestart();
 119   3                }           
 120   2                else
 121   2                {           
 122   3                   ReceiveRestart();
 123   3                }
 124   2              }
 125   1              
 126   1              else
 127   1              {
 128   2                rx[RxLen] = temp;
 129   2                RxLen++;
 130   2                SCICheckout += temp;
 131   2              }
 132   1      }
 133          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    455    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =     12    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
